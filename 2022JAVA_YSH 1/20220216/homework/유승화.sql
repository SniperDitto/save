
-- 고객이 영화를 예매한다
-- 고객 / 영화 : 엔티티
-- 예매 : 행위


-- 고객 테이블 : ID, 이름, 나이, 성별
-- DROP TABLE CUSTOMERS;
CREATE TABLE CUSTOMERS(
    CUSID       CHAR(4)         NOT NULL    PRIMARY KEY,
    CUSNAME     VARCHAR2(20)    NOT NULL,
    CUSAGE      NUMBER(2)       NOT NULL,
    CUSGENDER   CHAR(1)         NOT NULL
);

-- 영화 테이블 : ID, 제목, 나이제한, 상영시간, 장르
-- DROP TABLE MOVIES;
CREATE TABLE MOVIES(
    MOVID       CHAR(4)         NOT NULL    PRIMARY KEY,
    MOVTITLE    VARCHAR2(50)    NOT NULL,
    MOVRATING   VARCHAR2(4)     NOT NULL,
    RTIME       NUMBER(3)       NOT NULL,
    MOVGENRE    VARCHAR2(20)    NOT NULL
);


-- 예매 테이블 : 순번, 고객ID, 영화ID, 예매일, 좌석, 구분(성인/청소년)
-- DROP TABLE TICKETS;
CREATE TABLE TICKETS(
    TIDX        NUMBER(3)       NOT NULL    PRIMARY KEY,
    CUSID       CHAR(4)         NOT NULL,
    MOVID       CHAR(4)         NOT NULL,
    BOOKDATE    VARCHAR2(8)     NOT NULL,
    SEAT        CHAR(3)         NOT NULL,
    BOOKTYPE    VARCHAR2(10)    NOT NULL
);


-- 고객 데이터 추가
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C001', '홍길동', 25, 'M');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C002', '홍길순', 25, 'F');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C003', '고길동', 40, 'M');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C004', '전우치', 29, 'M');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C005', '김철수', 33, 'M');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C006', '김영희', 30, 'F');
INSERT INTO CUSTOMERS(CUSID, CUSNAME, CUSAGE, CUSGENDER) VALUES('C007', '강감찬', 35, 'M');

-- 영화 데이터 추가
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M001', '언차티드', 'PG12', 116, 'ACTION');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M002', '더 배트맨', 'PG15', 176, 'ACTION');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M003', '리코리쉬 피자', 'PG15', 134, 'DRAMA');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M004', '나일 강의 죽음', 'PG12', 127, 'MYSTERY');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M005', '듄', 'PG12', 155, 'SF');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M006', '해리 포터와 불사조 기사단', 'G', 137, 'FANTASY');
INSERT INTO MOVIES(MOVID, MOVTITLE, MOVRATING, RTIME, MOVGENRE) VALUES('M007', '스파이더맨 - 노 웨이 홈', 'PG12', 148, 'ACTION');

-- 예매 데이터 추가
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(1, 'C001', 'M001', '20220215', 'K15', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(2, 'C001', 'M001', '20220215', 'K16', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(3, 'C002', 'M003', '20220214', 'J10', 'CHILD');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(4, 'C002', 'M003', '20220214', 'J09', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(5, 'C003', 'M006', '20220213', 'H22', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(6, 'C003', 'M006', '20220213', 'H23', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(7, 'C004', 'M004', '20220212', 'L16', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(8, 'C005', 'M007', '20220214', 'K16', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(9, 'C006', 'M007', '20220214', 'K17', 'ADULT');
INSERT INTO TICKETS(TIDX, CUSID, MOVID, BOOKDATE, SEAT, BOOKTYPE)
VALUES(10, 'C007', 'M005', '20220211', 'I21', 'ADULT');

SELECT * FROM CUSTOMERS;
SELECT * FROM MOVIES;
SELECT * FROM TICKETS;
--COMMIT;


--1. 고객 이름이 홍길동인 사람이 예매한 표의 매수
SELECT T1.CUSNAME, COUNT(*) 
FROM CUSTOMERS T1, TICKETS T2
WHERE T1.CUSID=T2.CUSID AND T1.CUSNAME='홍길동' GROUP BY T1.CUSNAME;

--2. 많이 예매한 영화 순위
SELECT T2.MOVTITLE, COUNT(*)
FROM TICKETS T1, MOVIES T2
WHERE T1.MOVID=T2.MOVID GROUP BY T2.MOVTITLE ORDER BY COUNT(*) DESC;

--3. 남성 고객들이 많이 예매한 영화 순위
SELECT T1.CUSGENDER, T2.MOVTITLE, COUNT(*)
FROM CUSTOMERS T1, MOVIES T2, TICKETS T3
WHERE T1.CUSID=T3.CUSID AND T2.MOVID=T3.MOVID AND T1.CUSGENDER='M'
GROUP BY T1.CUSGENDER, T2.MOVTITLE ORDER BY COUNT(*) DESC;

